---
layout: default
---

{% assign items_raw = site.sources | where: 'type', page.type %}
{% assign items = items_raw | sort: 'year' %}

{% if items.size > 1 %}
  {% for item in items %}
    {% if item.title == page.title %}
      {% assign item_index = forloop.index %}
    {% endif %}
  {% endfor %}

  {% assign prev_index = item_index | plus: 1 %}
  {% assign next_index = item_index | minus: 1 %}

  {% for item in items %}
    {% if forloop.index == prev_index %}
      {% assign prev = item %}
    {% endif %}
    {% if forloop.index == next_index %}
      {% assign next = item %}
    {% endif %}
  {% endfor %}

  {% if prev %}
  <a href="{{ prev.url }}" class="sibling sibling--prev" title="{{ prev.title }}">{{ prev.title }}</a>
  {% endif %}
  {% if next %}
  <a href="{{ next.url }}" class="sibling sibling--next" title="{{ next.title }}">{{ next.title }}</a>
  {% endif %}
{% endif %}
{%- assign highlight-cover = page.title | url_encode | prepend: "/garden/assets/img/covers/" | append: ".jpg" -%}
<article class="highlight--book">
  <figure class="highlight--cover">
    <img src={{highlight-cover}} alt="Cover of {{page.title}}">
  </figure>
  <section class="highlight--main">
    <h1 class="highlight--title">{{page.title}}
      <span class="highlight--author">{{page.author}}</span>
    </h1>
    {%- for highlight in page.highlights -%}
      {%- assign highlight-target = highlight.text | truncatewords: 3 | downcase | url_encode | replace: "%20", "+" -%}
      <figure class="highlight" id="{{highlight-target}}">
        <blockquote class="highlight--quote">
          <span>{{highlight.text | markdownify}}</span>
        </blockquote>
        <figcaption class="highlight--caption">
          <cite class="highlight--cite">{{page.title}}</cite>
          <a class="highlight--page" href="#{{highlight-target}}">p. {{highlight.page}}</a>
        </figcaption>
      </figure>
    {%- endfor -%}
    <time datetime="{{ page.last_modified_at | date_to_xmlschema }}">{% if page.type != 'pages' %}
      Last updated on {{ page.last_modified_at | date: "%B %-d, %Y" }}
      {% endif %}
    </time>
    <side style="font-size: 0.9em">
      <h3 style="margin-bottom: 1em">Notes mentioning this note</h3>
      {% if page.backlinks.size > 0 %}
      <div style="display: grid; grid-gap: 1em; grid-template-columns: repeat(1fr);">
      {% for backlink in page.backlinks %}
        <div class="backlink-box">
        <a class="internal-link" href="{{ site.baseurl }}{{ backlink.url }}{%- if site.use_html_extension -%}.html{%- endif -%}">{{ backlink.title }}</a><br>
        <div style="font-size: 0.9em">{{ backlink.excerpt | strip_html | truncatewords: 20 }}</div>
        </div>
      {% endfor %}
      </div>
      {% else %}
  
      <div style="font-size: 0.9em">
        <p>
          There are no notes linking to this note.
        </p>
      </div>
      {% endif %}
    </side>
  </section>
</article>